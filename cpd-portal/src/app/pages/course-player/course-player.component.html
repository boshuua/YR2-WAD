<div class="course-player-container">
  <div *ngIf="isLoading" class="loading-message">Loading course...</div>
  <div *ngIf="errorMessage" class="error-message">{{ errorMessage }}</div>

  <div *ngIf="!isLoading && !errorMessage && course" class="course-content">
    <div class="course-header">
      <h1>{{ course.title }}</h1>
      <p class="course-description">{{ course.description }}</p>
    </div>

    <div class="lesson-navigation">
      <button (click)="prevLesson()" [disabled]="currentLessonIndex === 0">Previous Lesson</button>
      <span>Lesson {{ currentLessonIndex + 1 }} of {{ course.lessons.length }}</span>
      <button (click)="nextLesson()" [disabled]="currentLessonIndex === course.lessons.length - 1 && currentQuestionIndex === currentLesson.questions.length - 1">Next Lesson</button>
    </div>

    <div *ngIf="currentLesson" class="lesson-section">
      <h2>Lesson {{ currentLessonIndex + 1 }}: {{ currentLesson.title }}</h2>
      <p>{{ currentLesson.description }}</p>

      <div *ngIf="currentLesson.questions && currentLesson.questions.length > 0" class="question-section">
        <h3>Question {{ currentQuestionIndex + 1 }} of {{ currentLesson.questions.length }}</h3>
        <div *ngIf="currentQuestion" class="question-card">
          <p class="question-text">{{ currentQuestion.question_text }}</p>
          <div class="options-list">
            <div *ngFor="let option of currentQuestion.options" class="option-item">
              <input
                type="radio"
                [id]="'option-' + option.id"
                [value]="option.id"
                [name]="'question-' + currentQuestion.id"
                [(ngModel)]="selectedOptionId"
                [disabled]="currentQuestion.user_selected_option_id !== null"
              >
              <label [for]="'option-' + option.id">{{ option.option_text }}</label>
            </div>
          </div>
          <button
            class="submit-answer-btn"
            (click)="submitAnswer()"
            [disabled]="selectedOptionId === null || currentQuestion.user_selected_option_id !== null"
          >
            {{ currentQuestion.user_selected_option_id !== null ? 'Answered' : 'Submit Answer' }}
          </button>

          <div *ngIf="currentQuestion.user_selected_option_id !== null" class="feedback-message">
            <span *ngIf="currentQuestion.is_correct" class="correct-feedback">Correct!</span>
            <span *ngIf="!currentQuestion.is_correct" class="incorrect-feedback">Incorrect.</span>
          </div>
        </div>
      </div>
      <div *ngIf="!currentLesson.questions || currentLesson.questions.length === 0" class="no-questions-message">
        No questions for this lesson yet.
      </div>
    </div>
  </div>
</div>