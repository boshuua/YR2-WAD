<div class="user-management-panel">

  <div class="panel-header">
    <div class="header-left">
      <h2>Course Management</h2>
      <div class="tabs">
        <button class="tab-btn" [class.active]="currentTab === 'active'" (click)="switchTab('active')">Active
          Schedules</button>
        <button class="tab-btn" [class.active]="currentTab === 'template'"
          (click)="switchTab('template')">Templates</button>
      </div>
    </div>
    <button class="add-user-btn" (click)="addCourse()">
      {{ currentTab === 'active' ? '+ Schedule Course' : '+ Create Template' }}
    </button>
  </div>

  <div class="table-responsive">
    <div *ngIf="isLoading" class="loading-state">Loading courses...</div>
    <div *ngIf="errorMessage" class="error-message">{{ errorMessage }}</div>

    <table *ngIf="!isLoading && !errorMessage && courses.length > 0">
      <thead>
        <tr>
          <th>Title</th>
          <th>Description</th>
          <th *ngIf="currentTab === 'active'">Dates</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let course of courses">
          <td data-label="Title">{{ course.title }}</td>
          <td data-label="Description">{{ course.description | slice:0:100 }}{{ course.description.length > 100 ? '...'
            : '' }}</td>
          <td *ngIf="currentTab === 'active'" data-label="Dates">
            {{ course.start_date | date }} - {{ course.end_date | date }}
          </td>
          <td data-label="Actions" class="actions-cell">
            <button class="edit-btn" (click)="editCourse(course.id)">Edit</button>
            <button class="info-btn" (click)="manageQuestions(course.id)">Questions</button>
            <button class="delete-btn" (click)="promptDeleteCourse(course.id, course.title)">Delete</button>
          </td>
        </tr>
      </tbody>
    </table>

    <div *ngIf="!isLoading && noCoursesFound" class="no-data-message">
      No {{ currentTab === 'active' ? 'active courses' : 'templates' }} found.
      Click '{{ currentTab === 'active' ? '+ Schedule Course' : '+ Create Template' }}' to add one.
    </div>
  </div>
</div>

<!-- Schedule Modal -->
<div class="modal-backdrop" *ngIf="showScheduleModal">
  <div class="modal-content">
    <h3>Schedule Course from Template</h3>
    <form (ngSubmit)="scheduleCourse()">
      <div class="form-group">
        <label>Select Template</label>
        <select [(ngModel)]="scheduleData.templateId" name="templateId" required>
          <option [ngValue]="null" disabled>-- Select a Template --</option>
          <option *ngFor="let t of templates" [value]="t.id">{{ t.title }}</option>
        </select>
      </div>

      <div class="form-group">
        <label>Start Date</label>
        <input type="date" [(ngModel)]="scheduleData.startDate" name="startDate" required>
      </div>

      <div class="form-group">
        <label>End Date</label>
        <input type="date" [(ngModel)]="scheduleData.endDate" name="endDate" required>
      </div>

      <div class="form-group">
        <label>Custom Title (Optional)</label>
        <input type="text" [(ngModel)]="scheduleData.title" name="title"
          placeholder="Leave blank to use template title">
      </div>

      <div class="modal-actions">
        <button type="button" class="cancel-btn" (click)="closeScheduleModal()">Cancel</button>
        <button type="submit" class="confirm-btn" [disabled]="isScheduling">
          {{ isScheduling ? 'Scheduling...' : 'Schedule Course' }}
        </button>
      </div>
    </form>
  </div>
</div>

<app-confirm-modal [isVisible]="showDeleteConfirmModal" title="Confirm Deletion"
  [message]="'Are you sure you want to delete the course \'' + courseToDeleteTitle + '\'?'"
  confirmButtonText="Delete Course" cancelButtonText="Cancel" (confirmed)="confirmDelete()"
  (cancelled)="cancelDelete()">
</app-confirm-modal>