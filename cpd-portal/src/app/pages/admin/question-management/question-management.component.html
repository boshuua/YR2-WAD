<div class="user-management-panel">
  <div class="panel-header">
    <h2>Questions for Lesson ID: {{ lessonId }}</h2>
    <button class="add-item-btn" (click)="openAddQuestionModal()">+ Add Question</button>
  </div>

  <div class="table-responsive">
    <div *ngIf="isLoading">Loading questions...</div>
    <div *ngIf="errorMessage" class="error-message">{{ errorMessage }}</div>

    <table *ngIf="!isLoading && !errorMessage && questions.length > 0">
      <thead>
        <tr>
          <th>Question Text</th>
          <th>Type</th>
          <th>Options</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let question of questions">
          <td>{{ question.question_text | slice:0:100 }}{{ question.question_text.length > 100 ? '...' : '' }}</td>
          <td>{{ question.question_type }}</td>
          <td>
            <ul class="options-list">
              <li *ngFor="let option of question.options">
                {{ option.option_text }} <span *ngIf="option.is_correct" class="correct-option">(Correct)</span>
              </li>
            </ul>
          </td>
          <td>
            <button class="edit-btn" (click)="openEditQuestionModal(question)">Edit</button>
            <button class="delete-btn" (click)="promptDeleteQuestion(question.id, question.question_text)">Delete</button>
          </td>
        </tr>
      </tbody>
    </table>

    <div *ngIf="!isLoading && noQuestionsFound" class="no-data-message">
      No questions found for this lesson. Click 'Add Question' to create one.
    </div>
  </div>
</div>

<!-- Add/Edit Question Modal -->
<div class="modal-overlay" *ngIf="showAddEditQuestionModal">
  <div class="modal-content form-panel">
    <h3>{{ currentQuestion ? 'Edit Question' : 'Add New Question' }}</h3>
    <form (ngSubmit)="saveQuestion()">
      <div class="form-group">
        <label for="questionText">Question Text</label>
        <textarea id="questionText" [(ngModel)]="questionFormText" name="questionText" rows="4" required></textarea>
      </div>

      <div class="form-group">
        <label>Options</label>
        <div *ngFor="let option of questionFormOptions; let i = index" class="option-item">
          <input type="text" [(ngModel)]="option.option_text" name="optionText{{i}}" required>
          <input type="checkbox" [(ngModel)]="option.is_correct" name="isCorrect{{i}}" (change)="toggleCorrectOption(i)">
          <label>Correct</label>
          <button type="button" class="btn-danger btn-small" (click)="removeOption(i)">Remove</button>
        </div>
        <button type="button" class="btn-secondary btn-small" (click)="addOption()">Add Option</button>
      </div>

      <div class="form-actions">
        <button type="button" class="btn-secondary" (click)="closeAddEditQuestionModal()">Cancel</button>
        <button type="submit" class="btn-primary">{{ currentQuestion ? 'Update Question' : 'Create Question' }}</button>
      </div>
    </form>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<app-confirm-modal
  [isVisible]="showDeleteConfirmModal"
  title="Confirm Deletion"
  [message]="'Are you sure you want to delete the question \'' + questionToDeleteText + '\'? This will also delete all associated options.'"
  confirmButtonText="Delete Question"
  cancelButtonText="Cancel"
  (confirmed)="confirmDeleteQuestion()"
  (cancelled)="cancelDeleteQuestion()">
</app-confirm-modal>